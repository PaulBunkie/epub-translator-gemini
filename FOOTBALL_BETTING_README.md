# Футбольная aiналитика - Инструкция по использованию

## Логика работы сервиса

### Как работает анализ

Сервис автоматически отслеживает футбольные матчи в реальном времени и анализирует их для выявления выгодных ставок. Основная идея:

1. **Сбор матчей**: Сервис собирает матчи из ведущих лиг (EPL, La Liga, Serie A, Bundesliga, Лига Чемпионов и др.), отслеживая коэффициенты на победу фаворитов через The Odds API.

2. **Выявление фаворитов**: Матчи с коэффициентом на победу фаворита ≤ 1.30 автоматически помечаются как "матчи с фаворитом".

3. **Анализ первого тайма**: На 60-й минуте матча (после первого тайма) система:
   - Собирает детальную статистику матча (владение мячом, удары, xG, передачи и т.д.) через SofaScore API
   - Отправляет статистику ИИ-аналитику для оценки ситуации
   - ИИ анализирует: контролирует ли фаворит игру, или аутсайдер играет на пределе возможностей
   - Если ИИ считает, что фаворит способен выиграть несмотря на текущий счет - система фиксирует этот момент

4. **Телеграм-уведомления**: Если фаворит не выигрывает (проигрывает или играет вничью) после 60 минут, но ИИ прогнозирует победу - администратор получает уведомление в Telegram.

5. **Хранение данных**: Все матчи сохраняются в базу данных с:
   - Начальными коэффициентами (K0)
   - Последними коэффициентами перед матчем (K1)
   - Коэффициентами на 60-й минуте (K60)
   - Прогнозом ИИ на исход матча
   - Финальным счетом и результатом

### Зачем это нужно

**Основная стратегия**: Искать моменты, когда фаворит контролирует игру, но проигрывает или играет вничью. В таких ситуациях коэффициенты на победу фаворита могут быть завышены, что создает ценную возможность для ставок.

**Ключевое преимущество**: ИИ анализирует не только счет, но и глубокую статистику первого тайма, выявляя ситуации, когда текущий счет может не отражать реальное доминирование команды.

---

## Инструкция по использованию

### Доступ к интерфейсу

Откройте страницу `/bet` в браузере. Для административных функций (обновление данных, просмотр лимитов API) добавьте `?admin=true` в URL.

### Вкладка "С фаворитом"

**Назначение**: Ищем матчи, где фаворит может проиграть, но есть шансы на победу.

**Как использовать:**

1. **Столбец "Bet" (✓)**: 
   - Галочка означает, что матч прошел через ИИ-анализ на 60-й минуте
   - ИИ дал положительный прогноз (ДА) - фаворит способен выиграть

2. **Столбцы коэффициентов**:
   - **K0** - начальный коэффициент на победу фаворита (до начала матча)
   - **K1** - последний коэффициент перед матчем
   - **K60** - коэффициент на 60-й минуте (когда проводился анализ)
   - При наведении на K60 можно увидеть детальную статистику матча

3. **Прогноз ИИ**:
   - Показывает прогноз на исход матча: 1 (победа хозяев), X (ничья), 1X (не проиграют хозяева), X2 (не проиграют гости), 2 (победа гостей)
   - В скобках - коэффициент на прогнозируемый исход

4. **Итоговый счет**:
   - Зеленым - фаворит выиграл
   - Красным - фаворит проиграл
   - Желтым - ничья

5. **Итоги внизу таблицы**:
   - Показывают гипотетическую прибыль/убыток при ставке на каждый коэффициент
   - Рассчитываются только для завершенных матчей
   - Учитывается: для победы фаворита добавляется (коэффициент - 1), для проигрыша/ничьей вычитается 1

**Стратегия использования:**
- Обращайте внимание на матчи с галочкой (✓), где ИИ дал положительный прогноз
- Сравнивайте K0, K1, K60 - если K60 значительно выше, это может быть выгодной возможностью
- Изучайте статистику при наведении на K60 - проверяйте, действительно ли фаворит контролирует игру

---

### Вкладка "Все матчи"

**Назначение**: Подсвечиваем матчи, где игра может определиться или перевернуться во втором тайме.

**Как использовать:**

1. **Цветовая подсветка строк**:
   - **Светло-зеленые** - разница между коэффициентами на победу обеих команд ≤ 0.2 (равная игра, может пойти в любую сторону)
   - **Бледно-розовые** - текущий коэффициент на победу одной из команд < 1.30 (есть явный фаворит)
   - **Сиреневые** - был фаворит (коэффициент был ≤ 1.30), но сейчас коэффициент вырос ≥ 1.30 (фаворит "просел", ситуация изменилась)

2. **Столбцы коэффициентов**:
   - **1** - коэффициент на победу хозяев
   - **X** - коэффициент на ничью
   - **2** - коэффициент на победу гостей

3. **Прогноз ИИ**:
   - Показывает прогноз на исход матча
   - При наведении можно увидеть детальную статистику матча на 60-й минуте
   - При клике на прогноз открывается анализ риска от ИИ

4. **Итоговый счет**:
   - Подсвечивается цветом в зависимости от результата (зеленый/красный/желтый)

**Стратегия использования:**
- **Светло-зеленые строки** - матчи с равными шансами, где результат может быть непредсказуем. Хорошо подходят для ставок на "обе забьют" или "тотал больше".
- **Сиреневые строки** - матчи, где ситуация изменилась. Фаворит больше не является таковым - возможно, стоит рассмотреть ставку на аутсайдера или ничью.
- **Розовые строки** - классические матчи с фаворитом. Если фаворит не выигрывает на 60-й минуте, но ИИ прогнозирует победу - это может быть ценная возможность.

---

## Важные замечания

1. **Это инструмент для анализа, а не гарантия выигрыша**. Всегда анализируйте информацию самостоятельно перед принятием решения о ставке.

2. **Коэффициенты обновляются автоматически** каждые 5 минут для активных матчей. Завершенные матчи не обновляются.

3. **ИИ-прогноз** основан на статистике первого тайма. Второй тайм может развиваться по-другому.

4. **Используйте анализ риска** (клик на прогноз ИИ во вкладке "Все матчи") для получения дополнительной оценки от ИИ о целесообразности ставки.

5. **Следите за лимитами API** (в режиме администратора) - если лимиты исчерпаны, данные могут не обновляться.

---

## Технические детали

- **Источники данных**: The Odds API (коэффициенты), SofaScore API (статистика)
- **ИИ-модели**: Настраиваются в `workflow_model_config.py`
- **База данных**: SQLite (`football_matches.db`)
- **Обновление данных**: Автоматически каждые 5 минут (проверка матчей) и при синхронизации (обновление списка матчей)

