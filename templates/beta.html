<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>aiTube Beta - –í–∏–¥–µ–æ –ö–æ–ª–ª–∞–∂</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'fade-in-up': 'fadeInUp 0.6s ease forwards',
                        'scale-in': 'scaleIn 0.3s ease forwards',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .video-card {
            animation: fadeInUp 0.6s ease forwards;
        }
        
        .video-card:nth-child(1) { animation-delay: 0.1s; }
        .video-card:nth-child(2) { animation-delay: 0.2s; }
        .video-card:nth-child(3) { animation-delay: 0.3s; }
        .video-card:nth-child(4) { animation-delay: 0.4s; }
        .video-card:nth-child(5) { animation-delay: 0.5s; }
        
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
                 .line-clamp-5 {
             display: -webkit-box;
             -webkit-line-clamp: 5;
             -webkit-box-orient: vertical;
             overflow: hidden;
         }
         
         .line-clamp-3 {
             display: -webkit-box;
             -webkit-line-clamp: 3;
             -webkit-box-orient: vertical;
             overflow: hidden;
         }
        
        /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –º–∞–∫–µ—Ç–æ–≤ */
        .layout-masonry {
            grid-auto-rows: minmax(200px, auto);
        }
        
        .layout-adaptive {
            grid-auto-rows: minmax(180px, auto);
        }
        
        .layout-dynamic {
            grid-auto-rows: minmax(160px, auto);
        }
        
        .layout-smart {
            grid-auto-rows: minmax(180px, auto);
            grid-auto-flow: dense; /* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç –¥—ã—Ä—ã */
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900">
    <!-- Header -->
    <div class="relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-r from-blue-600/20 to-purple-600/20"></div>
        <div class="relative px-6 py-12">
            <div class="max-w-6xl mx-auto text-center">
                <h1 class="text-5xl font-bold text-white mb-4 bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">
                    –í–∏–¥–µ–æ –ö–æ–ª–ª–∞–∂
                </h1>
                <p class="text-xl text-gray-300 mb-8">
                    –≠—Ñ—Ñ–µ–∫—Ç–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –≤–∏–¥–µ–æ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
                </p>
                <div class="flex justify-center items-center space-x-4">
                    <button
                        id="toggle-translations"
                        class="px-6 py-3 rounded-full font-semibold transition-all duration-300 bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-lg hover:shadow-xl"
                    >
                        –ü–µ—Ä–µ–≤–æ–¥—ã –≤–∫–ª—é—á–µ–Ω—ã
                    </button>
                    <button
                        id="toggle-layout"
                        class="px-6 py-3 rounded-full font-semibold transition-all duration-300 bg-gradient-to-r from-green-500 to-teal-500 text-white shadow-lg hover:shadow-xl"
                    >
                        –ú–∞–∫–µ—Ç: –û–±—ã—á–Ω—ã–π
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Video Grid -->
    <div class="max-w-6xl mx-auto px-6 pb-12">
        <div id="videos-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Loading placeholder -->
            <div class="col-span-full text-center py-20">
                <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-white"></div>
                <p class="mt-4 text-white text-lg">–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ...</p>
            </div>
        </div>
    </div>

    <!-- Footer Stats -->
    <div class="bg-black/20 backdrop-blur-sm border-t border-white/10">
        <div class="max-w-6xl mx-auto px-6 py-8">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6 text-center">
                <div>
                    <div class="text-3xl font-bold text-white mb-2" id="total-videos">-</div>
                    <div class="text-gray-400 text-sm">–í—Å–µ–≥–æ –≤–∏–¥–µ–æ</div>
                </div>
                <div>
                    <div class="text-3xl font-bold text-white mb-2" id="total-views">-</div>
                    <div class="text-gray-400 text-sm">–û–±—â–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä—ã</div>
                </div>
                <div>
                    <div class="text-3xl font-bold text-white mb-2" id="total-subscribers">-</div>
                    <div class="text-gray-400 text-sm">–ü–æ–¥–ø–∏—Å—á–∏–∫–∏</div>
                </div>
                <div>
                    <div class="text-3xl font-bold text-white mb-2" id="total-duration">-</div>
                    <div class="text-gray-400 text-sm">–û–±—â–µ–µ –≤—Ä–µ–º—è</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Video Modal -->
    <div id="videoModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
                <div class="p-6">
                    <div class="flex justify-between items-start mb-4">
                        <h3 id="modalTitle" class="text-xl font-semibold text-gray-900"></h3>
                        <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div id="modalContent" class="space-y-4">
                        <!-- Content will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentVideos = [];
        let showTranslated = true;
        let isAdminMode = false;
        let currentLayout = 'normal'; // normal, masonry, adaptive, dynamic

        // Check admin mode on page load
        function checkAdminMode() {
            const urlParams = new URLSearchParams(window.location.search);
            isAdminMode = urlParams.get('admin') === 'true';
            console.log('[Beta] Admin mode:', isAdminMode);
        }

        // Format duration from seconds
        function formatDuration(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            if (hours > 0) {
                return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
            return `${minutes}:${secs.toString().padStart(2, '0')}`;
        }

        // Format numbers (K, M)
        function formatNumber(num) {
            if (num >= 1000000) {
                return `${(num / 1000000).toFixed(1)}M`;
            }
            if (num >= 1000) {
                return `${(num / 1000).toFixed(1)}K`;
            }
            return num.toString();
        }

        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU', {
                day: 'numeric',
                month: 'short',
                year: 'numeric'
            });
        }

        // Toggle translations
        document.getElementById('toggle-translations').addEventListener('click', function() {
            showTranslated = !showTranslated;
            this.textContent = showTranslated ? '–ü–µ—Ä–µ–≤–æ–¥—ã –≤–∫–ª—é—á–µ–Ω—ã' : '–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è';
            this.className = showTranslated 
                ? 'px-6 py-3 rounded-full font-semibold transition-all duration-300 bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-lg hover:shadow-xl'
                : 'px-6 py-3 rounded-full font-semibold transition-all duration-300 bg-white/10 text-gray-300 hover:bg-white/20';
            renderVideos(currentVideos);
        });

        // Toggle layout styles
        document.getElementById('toggle-layout').addEventListener('click', function() {
            const layouts = ['normal', 'masonry', 'adaptive', 'dynamic', 'smart'];
            const currentIndex = layouts.indexOf(currentLayout);
            const nextIndex = (currentIndex + 1) % layouts.length;
            currentLayout = layouts[nextIndex];
            
            const layoutNames = {
                'normal': '–û–±—ã—á–Ω—ã–π',
                'masonry': '–ú–∞—Å—Å–∏–≤–Ω—ã–π',
                'adaptive': '–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π',
                'dynamic': '–î–∏–Ω–∞–º–∏—á–Ω—ã–π',
                'smart': '–£–º–Ω—ã–π'
            };
            
            this.textContent = `–ú–∞–∫–µ—Ç: ${layoutNames[currentLayout]}`;
            renderVideos(currentVideos);
        });

        // Load videos from API
        async function loadVideos() {
            try {
                const response = await fetch('/api/toptube/videos?status=analyzed&limit=50');
                const data = await response.json();
                
                if (data.success) {
                    currentVideos = data.videos;
                    renderVideos(data.videos);
                    updateStats(data.videos);
                } else {
                    console.error('Error loading videos:', data.error);
                }
            } catch (error) {
                console.error('Error loading videos:', error);
            }
        }

        // Render videos grid
        function renderVideos(videos) {
            const container = document.getElementById('videos-container');
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º CSS –∫–ª–∞—Å—Å—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –º–∞–∫–µ—Ç–æ–≤
            container.className = `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 layout-${currentLayout}`;
            
            if (videos.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-20">
                        <div class="text-gray-400 text-6xl mb-4">üì∫</div>
                        <h3 class="text-white text-xl mb-2">–í–∏–¥–µ–æ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                        <p class="text-gray-400">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</p>
                    </div>
                `;
                return;
            }

            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–º–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –±–µ–∑ –¥—ã—Ä
            if (currentLayout === 'smart') {
                container.innerHTML = createSmartLayout(videos);
            } else {
                container.innerHTML = videos.map((video, index) => createVideoCard(video, index)).join('');
            }
        }

                 // –£–º–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –±–µ–∑ –¥—ã—Ä
         function createSmartLayout(videos) {
             const cols = 3; // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫ –≤ —Å–µ—Ç–∫–µ (3 –¥–ª—è FHD)
             const grid = Array(20).fill().map(() => Array(cols).fill(null)); // –°–æ–∑–¥–∞–µ–º —Å–µ—Ç–∫—É 20x3
             
             // –°–æ—Ä—Ç–∏—Ä—É–µ–º –≤–∏–¥–µ–æ –ø–æ video_id –≤ –ø–æ—Ä—è–¥–∫–µ —É–±—ã–≤–∞–Ω–∏—è
             const sortedVideos = [...videos].sort((a, b) => b.video_id - a.video_id);
             
             // –°–æ–∑–¥–∞–µ–º –æ—á–µ—Ä–µ–¥—å –≤–∏–¥–µ–æ —Å —Ä–∞–∑–º–µ—Ä–∞–º–∏
             const videoQueue = sortedVideos.map((video, index) => {
                 const title = showTranslated && video.translated_title ? video.translated_title : video.title;
                 const titleLength = title.length;
                 
                 // –ü–æ–ª—É—á–∞–µ–º –¥–ª–∏–Ω—É —Å–∞–º–º–∞—Ä–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
                 let summaryLength = 0;
                 if (video.analysis_summary) {
                     summaryLength = video.analysis_summary.length;
                 } else if (video.analysis_result) {
                     summaryLength = video.analysis_result.length;
                 }
                 
                 // –û–±—â–∞—è –¥–ª–∏–Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –∫–∞—Ä—Ç–æ—á–∫–∏
                 const totalContentLength = titleLength + summaryLength;
                 
                 let width = 1;
                 let height = 1;
                 
                                   // –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –¢–û–õ–¨–ö–û –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
                  const isPopular = video.views > 500000; // –ë–æ–ª—å—à–µ 500K –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
                  
                  if (isPopular) {
                      // –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –≤–∏–¥–µ–æ - –±–æ–ª—å—à–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ (2x1)
                      width = 2;
                      height = 1;
                  } else {
                      // –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ - –º–∞–ª–µ–Ω—å–∫–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ (1x1)
                      width = 1;
                      height = 1;
                  }
                 
                 return { video, width, height, index, totalContentLength, titleLength, summaryLength };
             });
             
             let html = '';
             
             // –ò–¥–µ–º –ø–æ —Å–µ—Ç–∫–µ —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑, —Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ
             for (let row = 0; row < grid.length; row++) {
                 for (let col = 0; col < cols; col++) {
                     // –ï—Å–ª–∏ –º–µ—Å—Ç–æ —É–∂–µ –∑–∞–Ω—è—Ç–æ, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                     if (grid[row][col] !== null) continue;
                     
                     // –ò—â–µ–º –ø–æ–¥—Ö–æ–¥—è—â—É—é –∫–∞—Ä—Ç–æ—á–∫—É –¥–ª—è —ç—Ç–æ–≥–æ –º–µ—Å—Ç–∞
                     let placed = false;
                     let videoIndex = -1;
                     
                     // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –∫–∞—Ä—Ç–æ—á–∫—É, –∫–æ—Ç–æ—Ä–∞—è —Ç–æ—á–Ω–æ –ø–æ–º–µ—Å—Ç–∏—Ç—Å—è
                     for (let i = 0; i < videoQueue.length; i++) {
                         const { video, width, height } = videoQueue[i];
                         
                         // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–º–µ—Å—Ç–∏—Ç—Å—è –ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∞
                         if (row + height <= grid.length && col + width <= cols) {
                             let canPlace = true;
                             
                             // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–≤–æ–±–æ–¥–Ω–æ –ª–∏ –º–µ—Å—Ç–æ
                             for (let r = row; r < row + height; r++) {
                                 for (let c = col; c < col + width; c++) {
                                     if (grid[r][c] !== null) {
                                         canPlace = false;
                                         break;
                                     }
                                 }
                                 if (!canPlace) break;
                             }
                             
                             if (canPlace) {
                                 // –†–∞–∑–º–µ—â–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É
                                 for (let r = row; r < row + height; r++) {
                                     for (let c = col; c < col + width; c++) {
                                         grid[r][c] = i;
                                     }
                                 }
                                 
                                 // –û–ø—Ä–µ–¥–µ–ª—è–µ–º CSS –∫–ª–∞—Å—Å—ã –¥–ª—è —Ä–∞–∑–º–µ—Ä–∞
                                 let sizeClass = '';
                                 if (width === 2 && height === 2) {
                                     sizeClass = 'md:col-span-2 lg:col-span-2';
                                 } else if (width === 2 && height === 1) {
                                     sizeClass = 'md:col-span-2 lg:col-span-2';
                                 } else if (width === 1 && height === 2) {
                                     sizeClass = 'lg:row-span-2';
                                 }
                                 
                                 html += createVideoCard(video, i, sizeClass);
                                 
                                 // –£–±–∏—Ä–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –∏–∑ –æ—á–µ—Ä–µ–¥–∏
                                 videoQueue.splice(i, 1);
                                 
                                 placed = true;
                                 videoIndex = i;
                                 break;
                             }
                         }
                     }
                     
                     // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –±–æ–ª—å—à—É—é –∫–∞—Ä—Ç–æ—á–∫—É, –∏—â–µ–º –º–∞–ª–µ–Ω—å–∫—É—é (1x1)
                     if (!placed) {
                         for (let i = 0; i < videoQueue.length; i++) {
                             const { video, width, height } = videoQueue[i];
                             
                             // –ò—â–µ–º –ª—é–±—É—é –∫–∞—Ä—Ç–æ—á–∫—É, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –º–∞–ª–µ–Ω—å–∫–æ–π
                             if (width === 1 && height === 1) {
                                 // –£–∂–µ –º–∞–ª–µ–Ω—å–∫–∞—è - —Ä–∞–∑–º–µ—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
                                 grid[row][col] = i;
                                 html += createVideoCard(video, i, '');
                                 videoQueue.splice(i, 1);
                                 placed = true;
                                 break;
                             } else {
                                 // –ë–æ–ª—å—à–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ - –∑–∞–±–∏–≤–∞–µ–º –Ω–∞ –ø—Ä–∞–≤–∏–ª–æ –∏ –¥–µ–ª–∞–µ–º –º–∞–ª–µ–Ω—å–∫–æ–π
                                 grid[row][col] = i;
                                 html += createVideoCard(video, i, '');
                                 videoQueue.splice(i, 1);
                                 placed = true;
                                 break;
                             }
                         }
                     }
                     
                     // –ï—Å–ª–∏ –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ä–∞–∑–º–µ—â–µ–Ω—ã, –≤—ã—Ö–æ–¥–∏–º
                     if (videoQueue.length === 0) break;
                 }
                 
                 // –ï—Å–ª–∏ –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ä–∞–∑–º–µ—â–µ–Ω—ã, –≤—ã—Ö–æ–¥–∏–º
                 if (videoQueue.length === 0) break;
             }
             
             // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –∫–æ–Ω—Å–æ–ª—å
             console.log('[Smart Layout] Grid after placement:', grid);
             console.log('[Smart Layout] Videos placed:', sortedVideos.length - videoQueue.length);
             console.log('[Smart Layout] Remaining in queue:', videoQueue.length);
             
             return html;
         }
        
        

        

        // Create video card HTML
        function createVideoCard(video, index, customSizeClass = null) {
            const thumbnailUrl = `https://img.youtube.com/vi/${video.video_id}/maxresdefault.jpg`;
            const title = showTranslated && video.translated_title ? video.translated_title : video.title;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–∑–º–µ—Ä –∫–∞—Ä—Ç–æ—á–∫–∏
            let sizeClass = '';
            
            if (customSizeClass) {
                // –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω –∫–∞—Å—Ç–æ–º–Ω—ã–π —Ä–∞–∑–º–µ—Ä (–¥–ª—è —É–º–Ω–æ–≥–æ –º–∞–∫–µ—Ç–∞)
                sizeClass = customSizeClass;
            } else {
                // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –º–∞–∫–µ—Ç–∞
                const isPopular = video.views > 500000; // –ë–æ–ª—å—à–µ 500K –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
                
                if (isPopular) {
                    // –ë–æ–ª—å—à–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –≤–∏–¥–µ–æ
                    sizeClass = 'md:col-span-2 lg:col-span-2';
                } else {
                    // –ú–∞–ª–µ–Ω—å–∫–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
                    sizeClass = '';
                }
            }
            
            return `
                <div class="group relative bg-white/5 backdrop-blur-sm rounded-2xl overflow-hidden border border-white/10 transition-all duration-500 hover:scale-105 hover:shadow-2xl hover:shadow-purple-500/25 ${sizeClass}">
                    <!-- Thumbnail -->
                    <div class="relative aspect-video bg-gradient-to-br from-gray-800 to-gray-900">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
                        <img
                            src="${thumbnailUrl}"
                            alt="${title}"
                            class="w-full h-full object-cover"
                            onerror="this.src='https://img.youtube.com/vi/${video.video_id}/hqdefault.jpg'"
                        />
                        
                        <!-- Duration Badge -->
                        <div class="absolute bottom-3 right-3 bg-black/80 text-white text-sm px-2 py-1 rounded-md font-medium">
                            ${formatDuration(video.duration)}
                        </div>
                        
                        <!-- Play Button -->
                        <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                            <div class="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center shadow-lg">
                                <div class="w-0 h-0 border-l-8 border-l-white border-t-4 border-t-transparent border-b-4 border-b-transparent ml-1"></div>
                            </div>
                        </div>
                    </div>

                                         <!-- Content -->
                     <div class="p-4 space-y-3">
                         <!-- Title -->
                         <h3 class="text-white font-semibold text-sm leading-tight">
                             ${title}
                         </h3>
                         
                                                   <!-- Summary (–µ—Å–ª–∏ –µ—Å—Ç—å) -->
                          ${video.analysis_summary ? `
                              <p class="text-gray-300 text-xs leading-tight opacity-80">
                                  ${video.analysis_summary}
                              </p>
                          ` : video.analysis_result ? `
                              <p class="text-gray-300 text-xs leading-tight opacity-80">
                                  ${video.analysis_result}
                              </p>
                          ` : ''}
                         
                         <!-- Channel -->
                         <div class="flex items-center space-x-2">
                             <div class="w-6 h-6 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center">
                                 <span class="text-white text-xs font-bold">
                                     ${video.channel_title.charAt(0)}
                                 </span>
                             </div>
                             <span class="text-gray-300 text-sm font-medium">
                                 ${video.channel_title}
                             </span>
                         </div>

                        <!-- Stats -->
                        <div class="flex items-center justify-between text-xs text-gray-400">
                            <div class="flex items-center space-x-4">
                                <div class="flex items-center space-x-1">
                                    <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                                    <span>${formatNumber(video.views)} –ø—Ä–æ—Å–º.</span>
                                </div>
                                <div class="flex items-center space-x-1">
                                    <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                    <span>${formatNumber(video.subscribers)}</span>
                                </div>
                            </div>
                            <span>${formatDate(video.published_at)}</span>
                        </div>

                        <!-- Status Badge -->
                        <div class="flex justify-between items-center">
                            <div class="px-2 py-1 rounded-full text-xs font-medium bg-green-500/20 text-green-400">
                                –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
                            </div>
                            
                            <button onclick="showVideoDetails('${video.video_id}')" class="text-blue-400 hover:text-blue-300 transition-colors duration-200">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Hover Overlay -->
                    <div class="absolute inset-0 bg-gradient-to-t from-purple-600/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                </div>
            `;
        }

        // Show video details modal
        function showVideoDetails(videoId) {
            const video = currentVideos.find(v => v.video_id === videoId);
            if (!video) return;

            const modal = document.getElementById('videoModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            
            modalTitle.textContent = showTranslated && video.translated_title ? video.translated_title : video.title;
            
            modalContent.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div>
                        <img src="https://img.youtube.com/vi/${video.video_id}/maxresdefault.jpg" 
                             alt="${video.title}" 
                             class="w-full rounded-lg"
                             onerror="this.src='https://img.youtube.com/vi/${video.video_id}/hqdefault.jpg'">
                        <div class="mt-4 space-y-2 text-sm text-gray-600">
                            <div><strong>–ö–∞–Ω–∞–ª:</strong> ${video.channel_title}</div>
                            <div><strong>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> ${formatDuration(video.duration)}</div>
                            <div><strong>–ü—Ä–æ—Å–º–æ—Ç—Ä—ã:</strong> ${formatNumber(video.views)}</div>
                            <div><strong>–ü–æ–¥–ø–∏—Å—á–∏–∫–∏:</strong> ${formatNumber(video.subscribers)}</div>
                            <div><strong>–î–∞—Ç–∞:</strong> ${formatDate(video.published_at)}</div>
                        </div>
                        <a href="${video.url}" target="_blank" class="mt-4 inline-block bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors">
                            –°–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ YouTube
                        </a>
                    </div>
                    <div>
                        ${video.analysis_summary ? `
                            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
                                <div class="flex">
                                    <div class="flex-shrink-0">
                                        <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                        </svg>
                                    </div>
                                    <div class="ml-3">
                                        <h3 class="text-sm font-medium text-yellow-800">–ö—Ä–∞—Ç–∫–∏–π –∞–Ω–∞–ª–∏–∑</h3>
                                        <div class="mt-2 text-sm text-yellow-700 line-clamp-5">
                                            ${video.analysis_summary}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        ` : video.analysis_result ? `
                            <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded">
                                <div class="flex">
                                    <div class="flex-shrink-0">
                                        <svg class="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                        </svg>
                                    </div>
                                    <div class="ml-3">
                                        <h3 class="text-sm font-medium text-blue-800">–ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑</h3>
                                        <div class="mt-2 text-sm text-blue-700 line-clamp-5">
                                            ${video.analysis_result.substring(0, 300)}${video.analysis_result.length > 300 ? '...' : ''}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        ` : `
                            <div class="bg-gray-50 border-l-4 border-gray-400 p-4 rounded">
                                <div class="flex">
                                    <div class="flex-shrink-0">
                                        <svg class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                        </svg>
                                    </div>
                                    <div class="ml-3">
                                        <h3 class="text-sm font-medium text-gray-800">–ê–Ω–∞–ª–∏–∑ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</h3>
                                        <div class="mt-2 text-sm text-gray-700">
                                            –î–ª—è —ç—Ç–æ–≥–æ –≤–∏–¥–µ–æ –ø–æ–∫–∞ –Ω–µ—Ç –∞–Ω–∞–ª–∏–∑–∞
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `}
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        // Close modal
        function closeModal() {
            document.getElementById('videoModal').classList.add('hidden');
        }

        // Update footer stats
        function updateStats(videos) {
            const totalVideos = videos.length;
            const totalViews = videos.reduce((sum, v) => sum + v.views, 0);
            const totalSubscribers = videos.reduce((sum, v) => sum + v.subscribers, 0);
            const totalDuration = videos.reduce((sum, v) => sum + v.duration, 0);
            
            document.getElementById('total-videos').textContent = totalVideos;
            document.getElementById('total-views').textContent = formatNumber(totalViews);
            document.getElementById('total-subscribers').textContent = formatNumber(totalSubscribers);
            document.getElementById('total-duration').textContent = Math.round(totalDuration / 3600) + '—á';
        }

        // Close modal on outside click
        document.getElementById('videoModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Close modal on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            checkAdminMode();
            loadVideos();
        });
    </script>
</body>
</html>
